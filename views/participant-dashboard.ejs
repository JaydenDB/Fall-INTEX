<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Ella Rises – My Dashboard</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@400;600;700&family=Playfair+Display:wght@500;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="/css/style.css">
</head>
<body>
  <div class="page">
    <%- include('partials/header') %>

    <section class="section">
      <div class="container">
        <div class="section-header" style="text-align:left;">
          <img src="/images/ella%20rises%20logo.png" alt="Ella Rises Logo" style="width: 70px; height: 70px; margin-bottom: 1rem;">
          <p class="section-kicker">My journey</p>
          <h2 class="section-title">Welcome, <%= participant.participantfirstname || 'Participant' %></h2>
          <p class="section-subtitle" style="margin-left:0;">
            This page shows your Ella Rises profile, events, surveys, milestones, and donations.
            Only you and admins can see this view.
          </p>
        </div>

        <div class="grid-2" style="margin-bottom:1.5rem;">
          <!-- Profile card -->
          <div class="card">
            <div style="display:flex; gap:1rem; align-items:center; margin-bottom:0.9rem;">
              <div
                style="
                  width:64px;
                  height:64px;
                  border-radius:50%;
                  background:rgba(235,216,255,0.7);
                  display:flex;
                  align-items:center;
                  justify-content:center;
                  overflow:hidden;
                  font-weight:700;
                  color:#5b3f7a;
                  font-size:1.2rem;
                "
              >
                <% if (participant.participantphoto) { %>
                  <img src="<%= participant.participantphoto %>" alt="Profile photo" style="width:100%; height:100%; object-fit:cover;" />
                <% } else { %>
                  <%= (participant.participantfirstname || '?')[0] %><%= (participant.participantlastname || '')[0] || '' %>
                <% } %>
              </div>
              <div>
                <div style="font-weight:700; font-size:1.05rem;">
                  <%= (participant.participantfirstname || '') + ' ' + (participant.participantlastname || '') %>
                </div>
                <div style="font-size:0.85rem; color:var(--text-muted);">
                  <%= participant.participantemail %>
                </div>
              </div>
            </div>

            <div style="font-size:0.85rem;">
              <p><strong>City / State:</strong>
                <%= participant.participantcity || '—' %>, <%= participant.participantstate || '—' %>
              </p>
              <p><strong>School / Employer:</strong>
                <%= participant.participantschooloremployer || '—' %>
              </p>
              <p><strong>Field of interest:</strong>
                <%= participant.participantfieldofinterest || '—' %>
              </p>
              <p><strong>Phone:</strong>
                <%= participant.participantphone || '—' %>
              </p>
            </div>
          </div>

          <!-- High-level stats -->
          <div class="card">
            <p class="section-kicker" style="margin-bottom:0.3rem;">My stats</p>
            <div style="display:flex; flex-wrap:wrap; gap:1.1rem; font-size:0.9rem;">
              <div>
                <div style="font-size:1.5rem; font-weight:700;">
                  $<%= stats.donations.totalAmount.toLocaleString('en-US', {minimumFractionDigits:2, maximumFractionDigits:2}) %>
                </div>
                <div style="color:var(--text-muted);">Total donations</div>
              </div>
              <div>
                <div style="font-size:1.5rem; font-weight:700;"><%= stats.registrations.totalRegistrations %></div>
                <div style="color:var(--text-muted);">Events registered</div>
              </div>
              <div>
                <div style="font-size:1.5rem; font-weight:700;"><%= stats.registrations.totalAttended %></div>
                <div style="color:var(--text-muted);">Events attended</div>
              </div>
              <div>
                <div style="font-size:1.5rem; font-weight:700;"><%= stats.surveys.totalSurveys %></div>
                <div style="color:var(--text-muted);">Surveys submitted</div>
              </div>
            </div>
          </div>
        </div>

        <!-- Survey & donation summaries -->
        <div class="grid-2" style="margin-bottom:1.5rem;">
          <div class="card">
            <p class="section-kicker" style="margin-bottom:0.3rem;">My survey experience</p>
            <% if (stats.surveys.totalSurveys > 0) { %>
              <p style="font-size:0.9rem; color:var(--text-muted); margin-bottom:0.4rem;">
                Averages based on <strong><%= stats.surveys.totalSurveys %></strong> surveys you’ve submitted.
              </p>
              <div style="display:flex; flex-wrap:wrap; gap:1.1rem; font-size:0.9rem;">
                <div>
                  <div style="font-size:1.4rem; font-weight:700;"><%= stats.surveys.avgOverall %> / 5</div>
                  <div style="color:var(--text-muted);">Overall</div>
                </div>
                <div>
                  <div style="font-size:1.2rem; font-weight:700;"><%= stats.surveys.avgSatisfaction %> / 5</div>
                  <div style="color:var(--text-muted);">Satisfaction</div>
                </div>
                <div>
                  <div style="font-size:1.2rem; font-weight:700;"><%= stats.surveys.avgUsefulness %> / 5</div>
                  <div style="color:var(--text-muted);">Usefulness</div>
                </div>
                <div>
                  <div style="font-size:1.2rem; font-weight:700;"><%= stats.surveys.avgRecommend %> / 5</div>
                  <div style="color:var(--text-muted);">Would recommend</div>
                </div>
              </div>
            <% } else { %>
              <p style="font-size:0.9rem; color:var(--text-muted);">
                Once you start completing post-event surveys, you’ll see your averages here.
              </p>
            <% } %>
          </div>

          <div class="card">
            <p class="section-kicker" style="margin-bottom:0.3rem;">My giving</p>
            <% if (stats.donations.donationCount > 0) { %>
              <p style="font-size:0.9rem; color:var(--text-muted); margin-bottom:0.4rem;">
                Thank you for supporting other girls through Ella Rises programs.
              </p>
              <p style="font-size:0.85rem; color:var(--text-muted);">
                Gifts made: <strong><%= stats.donations.donationCount %></strong><br/>
                First gift: <%= stats.donations.firstDonation ? stats.donations.firstDonation.toISOString().slice(0,10) : '—' %><br/>
                Most recent: <%= stats.donations.lastDonation ? stats.donations.lastDonation.toISOString().slice(0,10) : '—' %>
              </p>
            <% } else { %>
              <p style="font-size:0.9rem; color:var(--text-muted);">
                You haven’t made a donation in this system yet. That’s totally fine—your participation is valuable too!
              </p>
            <% } %>
          </div>
        </div>

        <!-- Recent activity -->
        <div class="grid-2">
          <div class="card">
            <h3 style="margin-bottom:0.4rem;">Recent surveys</h3>
            <table style="width:100%; border-collapse:collapse; font-size:0.85rem;">
              <thead>
                <tr style="text-align:left; border-bottom:1px solid rgba(235,216,255,0.9);">
                  <th style="padding:0.4rem;">Event</th>
                  <th style="padding:0.4rem;">Date</th>
                  <th style="padding:0.4rem;">Overall</th>
                </tr>
              </thead>
              <tbody>
                <% if (!stats.surveys.recent || stats.surveys.recent.length === 0) { %>
                  <tr>
                    <td colspan="3" style="padding:0.6rem; color:var(--text-muted);">
                      No survey responses yet.
                    </td>
                  </tr>
                <% } else { %>
                  <% stats.surveys.recent.forEach(s => { %>
                    <tr style="border-top:1px solid rgba(245,235,255,0.9);">
                      <td style="padding:0.4rem;"><%= s.eventname || 'Event' %></td>
                      <td style="padding:0.4rem;">
                        <%= s.surveysubmissiondate ? s.surveysubmissiondate.toISOString().slice(0,10) : '—' %>
                      </td>
                      <td style="padding:0.4rem;"><%= s.surveyoverallscore || '—' %></td>
                    </tr>
                  <% }) %>
                <% } %>
              </tbody>
            </table>
          </div>

          <div class="card">
            <h3 style="margin-bottom:0.4rem;">My milestones</h3>
            <ul style="list-style:none; padding:0; margin:0; font-size:0.85rem;">
              <% if (!stats.milestones || stats.milestones.length === 0) { %>
                <li style="padding:0.4rem 0; color:var(--text-muted);">
                  No milestones recorded yet. As you reach key education and career moments, Ella Rises staff can log them here.
                </li>
              <% } else { %>
                <% stats.milestones.forEach(m => { %>
                  <li style="padding:0.35rem 0; border-bottom:1px solid rgba(245,235,255,0.9);">
                    <strong><%= m.milestonetitle %></strong><br/>
                    <span style="font-size:0.78rem; color:var(--text-muted);">
                      <%= m.milestonedate ? m.milestonedate.toISOString().slice(0,10) : '—' %>
                    </span>
                  </li>
                <% }) %>
              <% } %>
            </ul>
          </div>
        </div>
      </div>
    </section>

    <%- include('partials/footer') %>
  </div>
</body>
</html>
