<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Ella Rises â€“ Admin Dashboards</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@400;600;700&family=Playfair+Display:wght@500;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="/css/style.css">
</head>
<body>
  <div class="page">
    <%- include('partials/header') %>

    <section class="section">
      <div class="container">
        <div class="section-header">
          <img src="/images/ella%20rises%20logo.png" alt="Ella Rises Logo" style="width: 80px; height: 80px; margin: 0 auto 1rem; display: block;">
          <p class="section-kicker">Admin</p>
          <h2 class="section-title">Impact Dashboards</h2>
          <p class="section-subtitle">
            Live KPIs from surveys, milestones, and donations. Use this page to tell the
            story of which experiences are leading to long-term STEAM outcomes.
          </p>
        </div>

        <!-- KPI ROW -->
        <div class="grid-3" style="margin-bottom:1.5rem;">
          <div class="card">
            <p class="section-kicker" style="margin-bottom:0.3rem;">Survey experience</p>
            <% if (kpis) { %>
              <div style="font-size:2rem; font-weight:700;">
                <%= kpis.avgSatisfaction %> / 5
              </div>
              <p style="font-size:0.9rem; color:var(--text-muted); margin:0.3rem 0;">
                Average satisfaction across <strong><%= kpis.totalSurveys %></strong> survey responses.
              </p>
              <div style="display:flex; gap:1rem; margin-top:0.6rem; font-size:0.85rem;">
                <div>
                  <div style="font-weight:600;"><%= kpis.avgUsefulness %> / 5</div>
                  <div style="color:var(--text-muted);">Usefulness</div>
                </div>
                <div>
                  <div style="font-weight:600;"><%= kpis.avgRecommend %> / 5</div>
                  <div style="color:var(--text-muted);">Would recommend</div>
                </div>
              </div>
            <% } else { %>
              <p style="font-size:0.9rem; color:var(--text-muted);">
                No survey data yet. Once surveys are loaded, this card will show averages.
              </p>
            <% } %>
          </div>

          <div class="card">
            <p class="section-kicker" style="margin-bottom:0.3rem;">STEAM outcomes</p>
            <% if (kpis) { %>
              <div style="display:flex; flex-direction:column; gap:0.4rem; font-size:0.9rem;">
                <div>
                  <div style="font-size:1.4rem; font-weight:700;"><%= kpis.steamGradRate %></div>
                  <div style="color:var(--text-muted);">
                    Participants with STEAM degree milestones (BS/MS in engineering, data, art & design, etc.).
                  </div>
                </div>
                <div>
                  <div style="font-size:1.4rem; font-weight:700;"><%= kpis.steamJobRate %></div>
                  <div style="color:var(--text-muted);">
                    Participants with STEAM internships or job-like milestones.
                  </div>
                </div>
              </div>
            <% } else { %>
              <p style="font-size:0.9rem; color:var(--text-muted);">
                Milestones will populate these percentages automatically once loaded.
              </p>
            <% } %>
          </div>

          <div class="card">
            <p class="section-kicker" style="margin-bottom:0.3rem;">Donor impact</p>
            <% if (kpis) { %>
              <div style="font-size:1.6rem; font-weight:700;">
                $<%= Number(kpis.totalDonations).toLocaleString('en-US', {minimumFractionDigits: 2, maximumFractionDigits: 2}) %>
              </div>
              <p style="font-size:0.9rem; color:var(--text-muted); margin:0.3rem 0;">
                Total recorded donations from <strong><%= kpis.donorCount %></strong> unique donor emails.
              </p>
              <p style="font-size:0.8rem; color:var(--text-muted);">
                Use this card when talking with potential funders to show scale of support to date.
              </p>
            <% } else { %>
              <p style="font-size:0.9rem; color:var(--text-muted);">
                No donations recorded yet. Once donations are made, this card will update in real time.
              </p>
            <% } %>
          </div>
        </div>

        <!-- TOP EVENTS TABLE -->
        <div class="card" style="margin-bottom:1.5rem;">
          <div style="display:flex; justify-content:space-between; align-items:flex-end; margin-bottom:0.6rem;">
            <div>
              <h3 style="margin:0 0 0.25rem;">Top events by overall score</h3>
              <p style="font-size:0.85rem; color:var(--text-muted); margin:0;">
                Pulled from the Surveys table, grouped by Event Name.
              </p>
            </div>
          </div>

          <table style="width:100%; border-collapse:collapse; font-size:0.88rem;">
            <thead>
              <tr style="text-align:left; border-bottom:1px solid rgba(235,216,255,0.9);">
                <th style="padding:0.45rem;">Event name</th>
                <th style="padding:0.45rem;">Responses</th>
                <th style="padding:0.45rem;">Avg overall</th>
                <th style="padding:0.45rem;">Avg satisfaction</th>
              </tr>
            </thead>
            <tbody>
              <% if (!topEvents || topEvents.length === 0) { %>
                <tr>
                  <td colspan="4" style="padding:0.8rem; color:var(--text-muted);">
                    No survey data yet. Once surveys are recorded, this table will rank events automatically.
                  </td>
                </tr>
              <% } else { %>
                <% topEvents.forEach(ev => { %>
                  <tr style="border-top:1px solid rgba(245,235,255,0.9);">
                    <td style="padding:0.45rem;"><strong><%= ev.name %></strong></td>
                    <td style="padding:0.45rem;"><%= ev.responseCount %></td>
                    <td style="padding:0.45rem;"><%= ev.avgOverall %> / 5</td>
                    <td style="padding:0.45rem;"><%= ev.avgSatisfaction %> / 5</td>
                  </tr>
                <% }) %>
              <% } %>
            </tbody>
          </table>
        </div>

        <!-- TABLEAU IMPACT DASHBOARD EMBED -->
        <div class="card" style="margin-bottom:1.5rem;">
          <h3 style="margin-bottom:0.5rem;">Ella Rises Impact Dashboard (Tableau)</h3>
          <p style="font-size:0.85rem; color:var(--text-muted); margin-bottom:0.8rem;">
            Explore live survey, milestone, and donation data in this Tableau dashboard.
          </p>

          <div class="tableauPlaceholder" id="viz1764789115052" style="position: relative">
            <noscript>
              <a href="#">
                <img alt="Ella Rises Impact Dashboard"
                     src="https://public.tableau.com/static/images/K4/K4PQQQQ4X/1_rss.png"
                     style="border: none" />
              </a>
            </noscript>
            <object class="tableauViz" style="display:none;">
              <param name="host_url" value="https%3A%2F%2Fpublic.tableau.com%2F" />
              <param name="embed_code_version" value="3" />
              <param name="path" value="shared&#47;K4PQQQQ4X" />
              <param name="toolbar" value="yes" />
              <param name="static_image" value="https:&#47;&#47;public.tableau.com&#47;static&#47;images&#47;K4&#47;K4PQQQQ4X&#47;1.png" />
              <param name="animate_transition" value="yes" />
              <param name="display_static_image" value="yes" />
              <param name="display_spinner" value="yes" />
              <param name="display_overlay" value="yes" />
              <param name="display_count" value="yes" />
              <param name="language" value="en-US" />
            </object>
          </div>
        </div>
      </div>
    </section>

    <%- include('partials/footer') %>
  </div>

  <!-- Tableau embed script -->
  <script type="text/javascript">
    var divElement = document.getElementById('viz1764789115052');
    if (divElement) {
      var vizElement = divElement.getElementsByTagName('object')[0];
      if (divElement.offsetWidth > 800) {
        vizElement.style.width = '100%';
        vizElement.style.height = (divElement.offsetWidth * 0.75) + 'px';
      } else if (divElement.offsetWidth > 500) {
        vizElement.style.width = '100%';
        vizElement.style.height = (divElement.offsetWidth * 0.75) + 'px';
      } else {
        vizElement.style.width = '100%';
        vizElement.style.height = '1127px';
      }
      var scriptElement = document.createElement('script');
      scriptElement.src = 'https://public.tableau.com/javascripts/api/viz_v1.js';
      vizElement.parentNode.insertBefore(scriptElement, vizElement);
    }
  </script>
</body>
</html>
